<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Ajout de polices et encodages</title>
<link type="text/css" rel="stylesheet" href="../fpdf.css">
<style type="text/css">
table {border-collapse:collapse; border-style:solid; border-width:2px; border-color:#A0A0A0 #000000 #000000 #A0A0A0}
table {margin:1.4em 0 1.4em 1em}
th {background-color:#E0EBFF; color:#900000; text-align:left}
th, td {border:1px solid #808080; padding:2px 10px}
tr.alt0 {background-color:#FFFFEE}
tr.alt1 {background-color:#FFFFE0}
</style>
</head>
<body>
<h1>Ajout de polices et encodages</h1>
Ce tutoriel explique comment ajouter des polices TrueType, OpenType et Type1 afin de ne plus se
limiter aux polices standard. L'autre intérêt est que l'on peut également choisir l'encodage des
caractères afin d'utiliser d'autres langues (les polices standard ayant trop peu de caractères
disponibles).
<br>
<br>
Remarque : pour l'OpenType, seul le format basé sur le TrueType est supporté (pas celui basé sur le Type1).
<br>
<br>
Il y a deux façons d'utiliser une nouvelle police : en l'incorporant ou pas. Lorsqu'une police
n'est pas incorporée, elle est recherchée dans le système. L'avantage est que le fichier PDF est
plus léger ; par contre, si elle n'est pas trouvée, une police de substitution est utilisée. Il
vaut donc mieux s'assurer que le système qui lit le PDF a bien la police installée ; si le fichier
doit être largement diffusé, il est fortement recommandé d'incorporer.
<br>
<br>
L'ajout d'une police se fait en deux étapes :
<ul>
<li>Génération du fichier de définition de police</li>
<li>Déclaration de la police dans le script</li>
</ul>
Pour les Type1, vous devez posséder le fichier AFM correspondant. Il est généralement fourni avec la police.

<h2>Génération du fichier de définition de police</h2>
La première étape consiste à générer un fichier PHP contenant toutes les informations dont FPDF a
besoin ; on en profite également pour compresser le fichier de police. Pour cela, un script est
fourni dans le répertoire makefont de l'archive : makefont.php. Il contient la fonction suivante :
<br>
<br>
<code>MakeFont(<b>string</b> fontfile, [, <b>string</b> enc [, <b>boolean</b> embed]])</code>
<dl class="param" style="margin-bottom:2em">
<dt><code>fontfile</code></dt>
<dd>
<p>Chemin du fichier .ttf, .otf ou .pfb.</p>
</dd>
<dt><code>enc</code></dt>
<dd>
<p>Nom de l'encodage à utiliser. Valeur par défaut : <code>cp1252</code>.</p>
</dd>
<dt><code>embed</code></dt>
<dd>
<p>Indique si la police doit être incorporée ou non. Valeur par défaut : <code>true</code>.</p>
</dd>
</dl>
Le premier paramètre est le nom du fichier de police. L'extension doit être .ttf, .otf ou .pfb et détermine
le type de la police. Si votre police Type1 est au format ASCII (.pfa), vous pouvez la convertir en binaire
(.pfb) grâce à <a href="http://www.lcdf.org/~eddietwo/type/#t1utils" target="_blank">t1utils</a>.
<br>
<br>
Pour les polices Type1, le fichier .afm correspondant doit se trouver dans le même répertoire.
<br>
<br>
L'encodage définit l'association entre un code (compris entre 0 et 255) et un caractère. Les 128
premières sont fixes et correspondent à l'ASCII ; les suivantes sont variables. Les encodages sont
stockés dans des fichiers .map. Ceux disponibles sont les suivants :
<ul>
<li>cp1250 (Europe Centrale)</li>
<li>cp1251 (cyrillique)</li>
<li>cp1252 (Europe de l'Ouest)</li>
<li>cp1253 (grec)</li>
<li>cp1254 (turc)</li>
<li>cp1255 (hébreu)</li>
<li>cp1257 (pays baltes)</li>
<li>cp1258 (vietnamien)</li>
<li>cp874 (thaïlandais)</li>
<li>ISO-8859-1 (Europe de l'Ouest)</li>
<li>ISO-8859-2 (Europe Centrale)</li>
<li>ISO-8859-4 (pays Baltes)</li>
<li>ISO-8859-5 (cyrillique)</li>
<li>ISO-8859-7 (grec)</li>
<li>ISO-8859-9 (turc)</li>
<li>ISO-8859-11 (thaïlandais)</li>
<li>ISO-8859-15 (Europe de l'Ouest)</li>
<li>ISO-8859-16 (Europe Centrale)</li>
<li>KOI8-R (russe)</li>
<li>KOI8-U (ukrainien)</li>
</ul>
Il faut bien sûr que la police contienne les caractères correspondant à l'encodage choisi.
<br>
<br>
Remarque : les polices standard utilisent cp1252.
<br>
<br>
Après avoir appelé la fonction (créez pour cela un nouveau fichier et incluez makefont.php), un
fichier .php est créé, avec le même nom que celui du fichier de police. Vous pouvez le renommer si
vous le souhaitez. Dans le cas de l'incorporation, le fichier de police est compressé et donne un
second fichier avec comme extension .z (sauf si la fonction de compression n'est pas disponible,
elle nécessite Zlib). Vous pouvez également le renommer, mais dans ce cas vous devez modifier la
variable <code>$file</code> en conséquence dans le fichier .php.
<br>
<br>
Exemple :
<div class="source">
<pre><code>&lt;?php
<span class="kw">require(</span><span class="str">'makefont/makefont.php'</span><span class="kw">);

</span>MakeFont<span class="kw">(</span><span class="str">'c:\\Windows\\Fonts\\comic.ttf'</span><span class="kw">,</span><span class="str">'cp1252'</span><span class="kw">);
</span>?&gt;</code></pre>
</div>
Ce qui donne les fichiers comic.php et comic.z.
<br>
<br>
Vous devez ensuite copier les fichiers générés dans le répertoire des polices. Si la police n'a
pas pu être compressée, il faut la copier directement à la place de la version compressée.
<br>
<br>
Il est également possible d'appeler MakeFont() via la ligne de commande :
<br>
<br>
<kbd>php makefont\makefont.php c:\Windows\Fonts\comic.ttf cp1252</kbd>
<br>
<br>
Enfin, pour les polices TrueType et OpenType, il est possible de générer les fichier
<a href="http://www.fpdf.org/makefont/">en ligne</a> au lieu de le faire manuellement.

<h2>Déclaration de la police dans le script</h2>
La seconde étape est la plus simple. Il suffit d'appeler la méthode <a href='../doc/addfont.htm'>AddFont()</a> :
<div class="source">
<pre><code>$pdf<span class="kw">-&gt;</span>AddFont<span class="kw">(</span><span class="str">'Comic'</span><span class="kw">,</span><span class="str">''</span><span class="kw">,</span><span class="str">'comic.php'</span><span class="kw">);
</span></code></pre>
</div>
Et la police est maintenant disponible (dans le style normal et souligné), utilisable comme les
autres. Si on avait traité le Comic Sans MS Gras (comicbd.ttf), on aurait mis :
<div class="source">
<pre><code>$pdf<span class="kw">-&gt;</span>AddFont<span class="kw">(</span><span class="str">'Comic'</span><span class="kw">,</span><span class="str">'B'</span><span class="kw">,</span><span class="str">'comicbd.php'</span><span class="kw">);
</span></code></pre>
</div>

<h2>Exemple</h2>
Voyons maintenant un exemple complet. La police utilisée est <a href="http://www.abstractfonts.com/font/52" target="_blank">Calligrapher</a>.
La première étape consiste à générer les fichiers :
<div class="source">
<pre><code>&lt;?php
<span class="kw">require(</span><span class="str">'makefont/makefont.php'</span><span class="kw">);

</span>MakeFont<span class="kw">(</span><span class="str">'calligra.ttf'</span><span class="kw">,</span><span class="str">'cp1252'</span><span class="kw">);
</span>?&gt;</code></pre>
</div>
L'exécution du script donne le compte-rendu suivant :
<br>
<br>
<b>Warning:</b> character Euro is missing<br>
<b>Warning:</b> character zcaron is missing<br>
Font file compressed: calligra.z<br>
Font definition file generated: calligra.php<br>
<br>
Le caractère euro n'est pas présent dans la police (elle est trop ancienne). Un autre caractère manque également.
<br>
<br>
Nous aurions également pu utiliser la ligne de commande :
<br>
<br>
<kbd>php makefont\makefont.php calligra.ttf cp1252</kbd>
<br>
<br>
ou bien le générateur en ligne.
<br>
<br>
Nous pouvons maintenant copier les deux fichiers générés dans le répertoire des polices (font) et écrire
le script :
<div class="source">
<pre><code>&lt;?php
<span class="kw">require(</span><span class="str">'fpdf.php'</span><span class="kw">);

</span>$pdf <span class="kw">= new </span>FPDF<span class="kw">();
</span>$pdf<span class="kw">-&gt;</span>AddFont<span class="kw">(</span><span class="str">'Calligrapher'</span><span class="kw">,</span><span class="str">''</span><span class="kw">,</span><span class="str">'calligra.php'</span><span class="kw">);
</span>$pdf<span class="kw">-&gt;</span>AddPage<span class="kw">();
</span>$pdf<span class="kw">-&gt;</span>SetFont<span class="kw">(</span><span class="str">'Calligrapher'</span><span class="kw">,</span><span class="str">''</span><span class="kw">,</span>35<span class="kw">);
</span>$pdf<span class="kw">-&gt;</span>Write<span class="kw">(</span>10<span class="kw">,</span><span class="str">'Changez de police avec FPDF !'</span><span class="kw">);
</span>$pdf<span class="kw">-&gt;</span>Output<span class="kw">();
</span>?&gt;</code></pre>
</div>
<p class='demo'><a href='tuto7.php' target='_blank' class='demo'>[Démo]</a></p>

<h2>A propos du symbole euro</h2>
Le caractère euro n'est pas présent dans tous les encodages, et n'est pas toujours situé à la
même position :
<table>
<tr><th>Encodage</th><th>Position</th></tr>
<tr class="alt0"><td>cp1250</td><td>128</td></tr>
<tr class="alt1"><td>cp1251</td><td>136</td></tr>
<tr class="alt0"><td>cp1252</td><td>128</td></tr>
<tr class="alt1"><td>cp1253</td><td>128</td></tr>
<tr class="alt0"><td>cp1254</td><td>128</td></tr>
<tr class="alt1"><td>cp1255</td><td>128</td></tr>
<tr class="alt0"><td>cp1257</td><td>128</td></tr>
<tr class="alt1"><td>cp1258</td><td>128</td></tr>
<tr class="alt0"><td>cp874</td><td>128</td></tr>
<tr class="alt1"><td>ISO-8859-1</td><td>absent</td></tr>
<tr class="alt0"><td>ISO-8859-2</td><td>absent</td></tr>
<tr class="alt1"><td>ISO-8859-4</td><td>absent</td></tr>
<tr class="alt0"><td>ISO-8859-5</td><td>absent</td></tr>
<tr class="alt1"><td>ISO-8859-7</td><td>absent</td></tr>
<tr class="alt0"><td>ISO-8859-9</td><td>absent</td></tr>
<tr class="alt1"><td>ISO-8859-11</td><td>absent</td></tr>
<tr class="alt0"><td>ISO-8859-15</td><td>164</td></tr>
<tr class="alt1"><td>ISO-8859-16</td><td>164</td></tr>
<tr class="alt0"><td>KOI8-R</td><td>absent</td></tr>
<tr class="alt1"><td>KOI8-U</td><td>absent</td></tr>
</table>
ISO-8859-1 est très répandu mais ne comporte pas l'euro. Si vous en avez besoin, le plus simple
consiste à prendre à la place cp1252 ou ISO-8859-15, qui sont pratiquement identiques mais
disposent du précieux caractère.

<h2>Réduction de la taille des polices TrueType</h2>
Les fichiers de police sont souvent volumineux ; c'est dû au fait qu'ils contiennent les caractères
correspondant à de nombreux encodages. La compression par Zlib les réduit mais les fichiers restent
encombrants. Il existe une technique pour diminuer la taille de ces fichiers. Elle consiste à convertir
la police en Type1 avec <a href="http://ttf2pt1.sourceforge.net" target="_blank">ttf2pt1</a> (l'exécutable
pour Windows est disponible <a href="http://www.fpdf.org/fr/dl.php?id=21">ici</a>) en précisant
l'encodage qui nous intéresse ; tous les autres caractères sont écartés.
<br>
Par exemple, la police arial.ttf livrée avec Windows Vista fait 748 ko (elle contient 3381 caractères).
Compressée, elle en fait 411. Convertissons-là en Type1 en ne conservant que les caractères correspondant
à l'encodage cp1250 :
<br>
<br>
<kbd>ttf2pt1 -b -L cp1250.map c:\Windows\Fonts\arial.ttf arial</kbd>
<br>
<br>
Les fichiers .map se trouvent dans le répertoire makefont de l'archive. On obtient alors
les fichiers arial.pfb et arial.afm. arial.pfb ne fait plus que 57 ko, et 53 après compression.
<br>
<br>
Il est possible d'aller encore plus loin. Si vous n'êtes intéressé que par un sous-ensemble de l'encodage
(il est peu probable que vous ayez besoin des 217 caractères), vous pouvez ouvrir le fichier .map et
enlever les lignes qui ne vous intéressent pas. Cela réduira d'autant la taille du fichier obtenu.
</body>
</html>
